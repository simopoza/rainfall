#include <stdio.h>
#include <stdlib.h>

// Global variable (from .bss section)
unsigned int m = 0;  // At address 0x8049810 - must be set to 16930116 for exploit

void p(char *buffer)
{
    // FORMAT STRING VULNERABILITY: User input used directly as format string
    printf(buffer);
}

void n(void)
{
    char buffer[520];  // Large buffer at EBP-520
    
    // Read up to 512 bytes from stdin (safe with fgets)
    fgets(buffer, 512, stdin);
    
    // Call p() with our buffer - this triggers the vulnerability
    p(buffer);
    
    // Check global variable 'm'
    if (m == 16930116) {  // 0x1025544 in hex
        // If condition met, execute system command
        system("/bin/cat /home/user/level5/.pass");  // Likely shows flag directly
    }
}

int main(void)
{
    n();
    return 0;
}
